<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Join Arena</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/peerjs@1.4.7/dist/peerjs.min.js"></script>
</head>
<body>
    <div class="menu-container">
        <input type="text" id="join-code-input" class="join-code-input" placeholder="Enter Join Code">
        <button id="join-btn">Join Arena</button>
        <p id="status"></p>
    </div>

    <script>
        const joinBtn = document.getElementById("join-btn");
        const codeInput = document.getElementById("join-code-input");
        const statusText = document.getElementById("status");

        joinBtn.addEventListener("click", () => {
            const joinCode = codeInput.value.trim().toLowerCase();
            if (!joinCode) {
                statusText.textContent = "Enter a code.";
                return;
            }

            // get saved display name from index page
            let displayName = localStorage.getItem("kb_display_name");
            if (!displayName || displayName.trim() === "") {
                displayName = "Guest";
            }

            const peer = new Peer();

            peer.on("open", () => {
                const conn = peer.connect(joinCode);

                conn.on("open", () => {
                    statusText.textContent = "Connected!";
                    
                    // send name to server
                    conn.send({
                        type: "join",
                        name: displayName
                    });
                });

                conn.on("data", data => {
                    console.log("Server:", data);
                });

                conn.on("error", () => {
                    statusText.textContent = "Server not found.";
                });
            });

            peer.on("error", () => {
                statusText.textContent = "Connection failed.";
            });
        });
    </script>
</body>
</html>
